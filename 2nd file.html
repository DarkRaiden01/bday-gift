<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Happy Birthday Website 2.0 | Aoudumber Bade">
    <meta name="github" content="https://github.com/Aoudumber-Bade">
    <title>Sayma Birthday</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>
    <div id="wrapper">
        <div class="flag__birthday">
            <img src="./pic/1.png" alt="" width="350" class="flag__left">
            <img src="./pic/1.png" alt="" width="350" class="flag__right">
        </div>
        <div class="content">
            <div class="left">
                <div class="title">
                    <h1 class="happy">
                        <span style="--t: 4s;">H</span>
                        <span style="--t: 4.2s;">a</span>
                        <span style="--t: 4.4s;">p</span>
                        <span style="--t: 4.6s;">p</span>
                        <span style="--t: 4.8s;">y</span>
                    </h1>
                    <h1 class="birthday">
                        <span style="--t: 5s;">B</span>
                        <span style="--t: 5.2s;">i</span>
                        <span style="--t: 5.4s;">r</span>
                        <span style="--t: 5.6s;">t</span>
                        <span style="--t: 5.8s;">h</span>
                        <span style="--t: 6s;">d</span>
                        <span style="--t: 6.2s;">a</span>
                        <span style="--t: 6.4s;">y</span>
                    </h1>
                    <div class="hat">
                        <img src="./pic/hat.png" alt="" width="130">
                    </div>
                </div>
                <div class="date__of__birth">
                    <span></span>
                </div>
                <div class="btn">
                    <button id="btn__letter">
                        <div class="mail">
                            Click Here Cutiee
                            <i class="fa-regular fa-envelope"></i>
                        </div>
                    </button>

                </div>
            </div>
            <div class="right">
                <div class="box__account">

                    <!-- MAIN PROFILE CIRCLE -->
                    <div class="image profile-main">
                        <img src="./pic/profile.png" alt="Profile">
                    </div>

                    <div class="name">
                        <i class="fa-solid fa-heart"></i>
                        <span>Dear Sayma</span>
                        <i class="fa-solid fa-heart"></i>
                    </div>

                    <div class="balloon_one">
                        <img width="100px" src="./pic/balloon1.png" alt="">
                    </div>

                    <div class="balloon_two">
                        <img width="100px" src="./pic/balloon2.png" alt="">
                    </div>

                </div>


            </div>
            <div class="cricle">
                <div class="text__cricle">
                    <span style="--i: 1;">h</span>
                    <span style="--i: 2;">a</span>
                    <span style="--i: 3;">p</span>
                    <span style="--i: 4;">p</span>
                    <span style="--i: 5;">y</span>
                    <span style="--i: 6;">-</span>
                    <span style="--i: 7;">b</span>
                    <span style="--i: 8;">i</span>
                    <span style="--i: 9;">r</span>
                    <span style="--i: 10;">t</span>
                    <span style="--i: 11;">h</span>
                    <span style="--i: 12;">d</span>
                    <span style="--i: 13;">a</span>
                    <span style="--i: 14;">y</span>
                    <span style="--i: 15;">-</span>
                </div>

                <!-- PROFILE IMAGE -->
                <div class="profile-circle">
                    <img src="./pic/corner.png" alt="Sayma">
                </div>
            </div>

            <div class="decorate_star star1" style="--t: 15s;"></div>
            <div class="decorate_star star2" style="--t: 15.2s;"></div>
            <div class="decorate_star star3" style="--t: 15.4s;"></div>
            <div class="decorate_star star4" style="--t: 15.6s;"></div>
            <div class="decorate_star star5" style="--t: 15.8s;"></div>
            <div class="decorate_flower--one" style="--t: 15s;">
                <img width="20" src="./pic/decorate_flower.png" alt="">
            </div>
            <div class="decorate_flower--two" style="--t: 15.3s;">
                <img width="20" src="./pic/decorate_flower.png" alt="">
            </div>
            <div class="decorate_flower--three" style="--t: 15.6s;">
                <img width="20" src="./pic/decorate_flower.png" alt="">
            </div>
            <div class="decorate_bottom">
                <img src="./pic/decorate.png" alt="" width="100">
            </div>
            <div class="smiley__icon">
                <img src="./pic/smiley_icon.png" alt="" width="100">
            </div>


            <div class="boxMail">
                <i class="fa-solid fa-xmark"></i>
                <div class="boxMail-container">
                    <div class="card1">
                        <div class="userImg">
                            <img src="pic/letter.png" alt="">
                        </div>
                        <h4 class="username">To: Sayma ðŸ’–<span class="underline"></span></h4>

                        <h3>Happy Birthday</h3>
                        <div class="imageCute">
                            <img src="cute1.png" alt="">
                        </div>
                    </div>
                    <div class="card2">
                        <div class="card2-content">
                            <h3>To You!</h3>
                            <h2> Happy Birthday Sayma ðŸ¥°! Hum dua karte hai tumhari life hamesha khushiyon se bhari rahe, aur tumhare saare dreams pure ho. ðŸ˜‡ Tum hamesha smile karte raho ðŸ’–Tumhari hoton p smile bada pyari lgti h ishe hamesha banaya rkho.
                                I wish I could remove some of the pain from your life which you are bearing alone. Agar kabhi life thodi tough lage, ya kuch share karna ho, toh mai hamesha yahan hoon. ðŸ¤— Enjoy your day to the fullest, cake khayo, masti
                                karo aur sabse zyada khud ke liye time spend karo! ðŸŽ‚ðŸ’–
                            </h2>

                            <div class="imageCute2">
                                <img src="cute2.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating video buttons and modals (original on bottom-right, new one bottom-left) -->
        <button id="videoFloatBtn2" class="video-float left" aria-label="Open second video">
            <i class="fa-solid fa-play"></i>
        </button>

        <div id="videoModal2" class="video-modal" aria-hidden="true" style="display:none;">
            <div class="video-overlay" id="videoOverlay2" tabindex="-1"></div>
            <div class="video-dialog" role="dialog" aria-modal="true" aria-labelledby="videoTitle2">
                <button id="videoClose2" class="video-close" aria-label="Close video">âœ–</button>
                <h2 id="videoTitle2" class="sr-only">Bargad video</h2>
                <video id="modalVideo2" controls preload="metadata">
                    <video controls src="https://drive.google.com/file/d/1xQjRK1-5uj1UCLuInz4XNRkA-ISP8awl/view?usp=drivesdk"></video> Your browser does not support the video tag.
                </video>
            </div>
        </div>

        <button id="videoFloatBtn" class="video-float" aria-label="Open birthday video">
            <i class="fa-solid fa-play"></i>
        </button>

        <div id="videoModal" class="video-modal" aria-hidden="true" style="display:none;">
            <div class="video-overlay" id="videoOverlay" tabindex="-1"></div>
            <div class="video-dialog" role="dialog" aria-modal="true" aria-labelledby="videoTitle">
                <button id="videoClose" class="video-close" aria-label="Close video">âœ–</button>
                <h2 id="videoTitle" class="sr-only">Birthday video</h2>
                <video id="modalVideo" controls preload="metadata">
  <source src="https://drive.google.com/uc?export=download&id=1KlkpMmAe_ONn_X5Uae106B4V_QbYBHwb" type="video/mp4">
</video>

            </div>
        </div>

        <!-- Small cake-cutting widget (isolated, non-invasive) -->
        <div id="cakeArea" aria-hidden="false">
            <div id="cakeWidget">
                <div id="cakeWrap">
                    <img id="cakeImg" class="cake-img" src="cake.png" alt="cake" width="72" height="64">
                    <!-- crumbs container (generated on cut) -->
                    <div id="crumbs" aria-hidden="true"></div>
                    <!-- candle image -->
                    <img id="candleImg" src="candle.png" alt="candle" width="60" height="75" style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1;">
                </div>
                <img id="knifeImg" class="knife-img" src="knife.png" alt="cut" width="36" height="28" role="button" tabindex="0" aria-label="Cut the cake">
            </div>

            <!-- Audio: user must provide `birthday-song.mp3` in same folder -->
            <audio id="cakeAudio" preload="none">
                <source src="Happy Birthday.mp3" type="audio/mpeg">
            </audio>
        </div>

</body>
<script>
    let datetxt = "27 December";
    let datatxtletter = "My love. You are a very special girl. I always silently thank you for coming into my life. Today, I wish you all the best, lots of health, and lots of joy. I always hope we will celebrate many more birthdays like this together. Happy birthday to you.ðŸ’•";
    let titleLetter = "To you";
    let charArrDate = datetxt.split('');
    let charArrDateLetter = datatxtletter.split('');
    let charArrTitle = titleLetter.split('');
    let currentIndex = 0;
    let currentIndexLetter = 0;
    let currentIndexTitle = 0;
    let date__of__birth = document.querySelector(".date__of__birth span");
    let text__letter = document.querySelector(".text__letter p");
    setTimeout(function() {
        timeDatetxt = setInterval(function() {
            if (currentIndex < charArrDate.length) {
                date__of__birth.textContent += charArrDate[currentIndex];
                currentIndex++;
            } else {
                let i = document.createElement("i");
                i.className = "fa-solid fa-star"
                document.querySelector(".date__of__birth").prepend(i)
                document.querySelector(".date__of__birth").appendChild(i.cloneNode(true))
                clearInterval(timeDatetxt)
            }
        }, 100)
    }, 12000)

    var intervalContent;
    var intervalTitle;
    $("#btn__letter").on("click", function() {
        $(".box__letter").slideDown()
        setTimeout(function() {
            $(".letter__border").slideDown();
        }, 1000)
        setTimeout(function() {
            intervalTitle = setInterval(function() {
                if (currentIndexTitle < charArrTitle.length) {
                    document.querySelector(".title__letter").textContent += charArrTitle[currentIndexTitle];
                    let i = document.createElement("i");
                    i.className = "fa-solid fa-heart"
                    document.querySelector(".title__letter").appendChild(i)
                    currentIndexTitle++;
                } else {
                    clearInterval(intervalTitle)
                }
            }, 100)
        }, 2000)
        setTimeout(function() {
            document.querySelector("#heart__letter").classList.add("animationOp");
            document.querySelector(".love__img").classList.add("animationOp");
            document.querySelector("#mewmew").classList.add("animationOp");
        }, 2800)
        setTimeout(function() {
            document.querySelectorAll(".heart").forEach((item) => {
                item.classList.add("animation")
            })
        }, 3500)
        setTimeout(function() {
            intervalContent = setInterval(function() {
                if (currentIndexLetter < charArrDateLetter.length) {
                    text__letter.textContent += charArrDateLetter[currentIndexLetter];
                    currentIndexLetter++;
                } else {
                    clearInterval(intervalContent)
                }
            }, 50)
        }, 6000)
    })
    $(".close").on("click", function() {
        clearInterval(intervalContent)
        document.querySelector(".title__letter").textContent = "";
        text__letter.textContent = "";
        currentIndexLetter = 0
        currentIndexTitle = 0
        document.querySelector("#heart__letter").classList.remove("animationOp");
        document.querySelector(".love__img").classList.remove("animationOp");
        document.querySelector("#mewmew").classList.remove("animationOp");
        document.querySelectorAll(".heart").forEach((item) => {
            item.classList.remove("animation")
        })
        $(".box__letter").slideUp();
        $(".letter__border").slideUp();
    })



    let mailBox = document.querySelector('.mail')
    let boxmail = document.querySelector('.boxMail')
    var close = document.querySelector('.fa-xmark')
    mailBox.onclick = function() {
        mailBox.classList.toggle('active')
        boxmail.classList.add('active')
    }

    close.addEventListener('click', function() {
        boxmail.classList.remove('active')
    })
</script>

<script>
    // Bind behaviour for right (bottom-right) button to open Google Drive link
    (function() {
        const openBtn = document.getElementById('videoFloatBtn');

        openBtn && openBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            window.open('https://drive.google.com/file/d/1KlkpMmAe_ONn_X5Uae106B4V_QbYBHwb/view?usp=drivesdk', '_blank');
        });
    })();
</script>

<script>
    // Bind behaviour for second (bottom-left) button to open Google Drive link
    (function() {
        const openBtn = document.getElementById('videoFloatBtn2');

        openBtn && openBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            window.open('https://drive.google.com/file/d/1xQjRK1-5uj1UCLuInz4XNRkA-ISP8awl/view?usp=drivesdk', '_blank');
        });
    })();
</script>

</html>

<!-- Premium two-corner party popper blast (fires exactly 12s after page load) -->
<script>
    (() => {
        'use strict';

        /* ========== CONFIGURATION ========== */
        const TRIGGER_DELAY_MS = 12000; // EXACT 12s trigger (setTimeout used)
        const DURATION_MS = 6000; // how long particles remain active
        const SOUND_ENABLED = false; // set true to allow sound (muted by default)
        const SOUND_SRC = './party-pop.mp3'; // optional audio file path

        // Particle counts tuned for "big" blast but mobile-friendly
        const DESKTOP_PER_SIDE = 220;
        const MOBILE_PER_SIDE = 120;
        const isMobile = Math.min(window.innerWidth, window.innerHeight) < 700;
        const PARTICLES_PER_SIDE = isMobile ? MOBILE_PER_SIDE : DESKTOP_PER_SIDE;

        // Visual tuning
        const COLORS = ['#FFD700', '#FF6FB5', '#C78CFF', '#5CE1FF', '#00FFA3', '#FFDD55'];
        const GRAVITY = 0.26;
        const DRAG = 0.997;

        /* ========== UTIL: overlay creation ========== */
        function createOverlay() {
            const canvas = document.createElement('canvas');
            canvas.className = 'popper-canvas';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.width = '100vw';
            canvas.style.height = '100vh';

            const audio = document.createElement('audio');
            audio.className = 'sr-only-audio';
            audio.preload = 'auto';
            audio.src = SOUND_SRC;
            audio.muted = !SOUND_ENABLED; // muted by default

            document.body.appendChild(canvas);
            document.body.appendChild(audio);

            function onResize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', onResize);

            return {
                canvas,
                audio,
                onResize
            };
        }

        /* ========== PARTICLES ========== */
        function makeParticle(x, y, vx, vy, size, color, type) {
            return {
                x,
                y,
                vx,
                vy,
                size,
                color,
                rot: Math.random() * Math.PI * 2,
                rotV: (Math.random() - 0.5) * 0.4,
                life: 0,
                type
            };
        }

        // Generate burst from bottom-left or bottom-right
        function generateBurst(side, count, canvas) {
            const particles = [];
            const w = canvas.width;
            const h = canvas.height;
            const baseX = side === 'left' ? Math.round(w * 0.05) : Math.round(w * 0.95);
            const baseY = Math.round(h * 0.96);

            for (let i = 0; i < count; i++) {
                // Aim upward with tilt toward center
                const baseAngle = side === 'left' ? -Math.PI * 0.55 : -Math.PI * 0.45; // tilt toward center
                const spread = (Math.PI / 3) * (Math.random() - 0.5); // wide spread
                const angle = baseAngle + spread + (Math.random() - 0.5) * 0.2;
                const speed = (isMobile ? 5.5 : 7.5) + Math.random() * (isMobile ? 4 : 6);
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                const size = 6 + Math.random() * 16;
                const color = COLORS[Math.floor(Math.random() * COLORS.length)];
                const type = Math.random() < 0.28 ? 'ribbon' : 'confetti';

                particles.push(makeParticle(baseX + (Math.random() - 0.5) * 36, baseY + (Math.random() - 0.5) * 12, vx, vy, size, color, type));
            }
            return particles;
        }

        /* ========== RENDER & PHYSICS ========== */
        function runParticles({
            canvas,
            audio,
            onResize
        }, leftCount, rightCount) {
            const ctx = canvas.getContext('2d');
            let particles = [];
            particles = particles.concat(generateBurst('left', leftCount, canvas));
            particles = particles.concat(generateBurst('right', rightCount, canvas));

            const start = performance.now();
            let rafId = null;

            // attempt to play sound (muted by default)
            try {
                audio && audio.play().catch(() => {});
            } catch (e) {}

            function frame(now) {
                const dt = Math.min(40, now - (frame.last || now));
                frame.last = now;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    // physics integration
                    p.vy += GRAVITY * (dt / 16.67);
                    p.vx *= DRAG;
                    p.vy *= DRAG;
                    p.x += p.vx * (dt / 16.67);
                    p.y += p.vy * (dt / 16.67);
                    p.rot += p.rotV * (dt / 16.67);
                    p.life += dt;

                    const lifeRatio = 1 - Math.min(1, p.life / DURATION_MS);

                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rot);
                    ctx.globalAlpha = Math.max(0, lifeRatio);

                    if (p.type === 'ribbon') {
                        const wRect = p.size * 0.5;
                        const hRect = p.size * 3.0;
                        const g = ctx.createLinearGradient(-wRect / 2, -hRect / 2, wRect / 2, hRect / 2);
                        g.addColorStop(0, p.color);
                        g.addColorStop(1, '#ffffff22');
                        ctx.fillStyle = g;
                        ctx.fillRect(-wRect / 2, -hRect / 2, wRect, hRect);
                    } else {
                        ctx.fillStyle = p.color;
                        ctx.fillRect(-p.size / 2, -p.size / 3, p.size, p.size * 0.6);
                    }

                    ctx.restore();

                    // remove expired or off-screen
                    if (p.life > DURATION_MS || p.y > canvas.height + 140 || p.x < -140 || p.x > canvas.width + 140) {
                        particles.splice(i, 1);
                    }
                }

                if (particles.length > 0) {
                    rafId = requestAnimationFrame(frame);
                } else {
                    cancelAnimationFrame(rafId);
                }
            }

            rafId = requestAnimationFrame(frame);

            // cleanup after DURATION_MS + buffer
            setTimeout(() => {
                try {
                    window.removeEventListener('resize', onResize);
                    canvas.parentNode && canvas.parentNode.removeChild(canvas);
                    audio && audio.parentNode && audio.parentNode.removeChild(audio);
                } catch (e) {}
            }, DURATION_MS + 800);
        }

        /* ========== LAUNCH BOTH POPPERS SIMULTANEOUSLY ========== */
        let launched = false;

        function launchPopperBlast() {
            if (launched) return;
            launched = true;
            const overlay = createOverlay();
            // ensure both bursts start together
            runParticles(overlay, PARTICLES_PER_SIDE, PARTICLES_PER_SIDE);
        }

        // expose manual trigger for testing
        window.launchPopperBlast = launchPopperBlast;

    })();
</script>

<!-- Cake-cut feature styles & behavior (keeps isolation and minimal footprint) -->
<style>
    /* Small, fixed widget centered at bottom; enlarged by ~50% */
    
    #cakeArea {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        z-index: 9999;
        pointer-events: none;
    }
    
    #cakeWidget {
        display: flex;
        align-items: center;
        gap: 18px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(0, 0, 0, 0.02));
        padding: 13px 14px;
        border-radius: 16px;
        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.12);
        pointer-events: auto;
    }
    
    #cakeWrap {
        position: relative;
        width: 176px;
        height: 144px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .cake-img {
        display: block;
        width: 162px;
        height: auto;
        transition: transform 420ms cubic-bezier(.2, .9, .3, 1), filter 420ms ease;
    }
    
    .cake-cut {
        transform: translateX(-27px) rotate(-6deg) scale(0.98);
        filter: brightness(.94) saturate(1.02);
    }
    
    .knife-img {
        width: 81px;
        height: auto;
        cursor: pointer;
        user-select: none;
        transition: transform 260ms ease;
    }
    
    .knife-press {
        transform: rotate(-18deg) translateY(2px);
    }
    /* crumb particles */
    
    .crumb {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        opacity: 1;
        transform: translate3d(0, 0, 0);
        transition: transform 900ms cubic-bezier(.2, .9, .3, 1), opacity 900ms linear;
        pointer-events: none;
        mix-blend-mode: screen;
    }
    
    @media (max-width:520px) {
        #cakeArea {
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
        }
        #cakeWidget {
            padding: 8px
        }
        .cake-img {
            width: 126px
        }
        .knife-img {
            width: 68px
        }
    }
</style>

<script>
    // Cake-cutting widget: minimal, responsive, and triggers audio only on user click
    (function() {
        const knife = document.getElementById('knifeImg');
        const cake = document.getElementById('cakeImg');
        const audio = document.getElementById('cakeAudio');
        const crumbs = document.getElementById('crumbs');

        if (!knife || !cake || !audio) return; // fail-safe

        // Utility: spawn crumb particles (lightweight)
        function spawnCrumbs(x, y, count) {
            count = Math.min(30, count || 18); // increased crumb count for bigger cake
            for (let i = 0; i < count; i++) {
                const c = document.createElement('div');

                c.className = 'crumb';
                c.style.background = ['#ffd3a5', '#fff0b8', '#ffd6e0', '#ffe8a8'][Math.floor(Math.random() * 4)];
                // place near center
                c.style.left = (x + (Math.random() - 0.5) * 44) + 'px';
                c.style.top = (y + (Math.random() - 0.5) * 28) + 'px';
                crumbs.appendChild(c);

                // compute small outward trajectory
                const angle = Math.random() * Math.PI * 2;
                const dist = 82 + Math.random() * 120; // larger spread for bigger cake
                const tx = Math.cos(angle) * dist;
                const ty = Math.sin(angle) * dist - (8 + Math.random() * 18);

                // animate on next frame
                requestAnimationFrame(() => {
                    c.style.transform = `translate3d(${tx}px, ${ty}px, 0) rotate(${Math.random()*360}deg) scale(${0.7+Math.random()*0.8})`;
                    c.style.opacity = '0';
                });

                // cleanup
                setTimeout(() => c.remove(), 1200 + Math.random() * 400);
            }
        }

        // Click handler: animate knife, cut cake, play audio (user gesture required)
        function handleCut(e) {
            // visual press
            knife.classList.add('knife-press');
            setTimeout(() => knife.classList.remove('knife-press'), 300);

            // apply cake cut animation class briefly
            cake.classList.add('cake-cut');
            setTimeout(() => cake.classList.remove('cake-cut'), 900);

            // spawn crumbs at cake center
            const rect = cake.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            spawnCrumbs(centerX, centerY, 10);

            // blow out the candle
            const candle = document.getElementById('candleImg');
            if (candle) {
                candle.style.transition = 'opacity 0.5s ease';
                candle.style.opacity = '0';
                setTimeout(() => candle.style.display = 'none', 500);
            }

            // play audio once (handle promise to avoid console warning)
            try {
                audio.currentTime = 0;
                const p = audio.play();
                if (p && p.then) p.catch(() => {});
            } catch (err) {}

            // Trigger party popper blast
            if (window.launchPopperBlast) {
                window.launchPopperBlast();
            }
        }

        // support click + keyboard activation (Enter/Space)
        knife.addEventListener('click', handleCut);
        knife.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                handleCut();
            }
        });

        // keep widget lightweight: defer preloading audio until first focus/click for user gesture
        knife.addEventListener('pointerdown', function() {
            if (audio.preload === 'none') audio.preload = 'auto';
        }, {
            once: true
        });
    })();
</script>
<!-- Mute cake audio while video modals are open -->
<script>
    (function() {
        const cakeAudio = document.getElementById('cakeAudio');
        if (!cakeAudio) return;
        let prevVolume = cakeAudio.volume;
        let wasPlaying = false;

        function muteAndPauseCake() {
            try {
                prevVolume = cakeAudio.volume;
            } catch (e) {}
            try {
                wasPlaying = !cakeAudio.paused;
            } catch (e) {
                wasPlaying = false;
            }
            try {
                cakeAudio.volume = 0;
            } catch (e) {}
        }

        function restoreCake() {
            try {
                cakeAudio.volume = prevVolume;
            } catch (e) {}
            // resume only if it was playing before
            if (wasPlaying) {
                try {
                    const p = cakeAudio.play();
                    if (p && p.then) p.catch(() => {});
                } catch (e) {}
            }
        }

        // Open buttons
        const btn1 = document.getElementById('videoFloatBtn');
        if (btn1) btn1.addEventListener('click', muteAndPauseCake);
        const btn2 = document.getElementById('videoFloatBtn2');
        if (btn2) btn2.addEventListener('click', muteAndPauseCake);

        // Close buttons and overlays
        const close1 = document.getElementById('videoClose');
        if (close1) close1.addEventListener('click', restoreCake);
        const close2 = document.getElementById('videoClose2');
        if (close2) close2.addEventListener('click', restoreCake);
        const overlay1 = document.getElementById('videoOverlay');
        if (overlay1) overlay1.addEventListener('click', restoreCake);
        const overlay2 = document.getElementById('videoOverlay2');
        if (overlay2) overlay2.addEventListener('click', restoreCake);

        // Escape key: if a modal is visible, restore cake audio
        document.addEventListener('keydown', function(e) {
            if (e.key !== 'Escape') return;
            const m1 = document.getElementById('videoModal');
            const m2 = document.getElementById('videoModal2');
            const visible = (m1 && m1.style.display && m1.style.display !== 'none') ||
                (m2 && m2.style.display && m2.style.display !== 'none');
            if (visible) setTimeout(restoreCake, 50);
        });
    })();
</script>